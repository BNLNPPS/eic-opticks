optix7_change_to_default
===========================

From :doc:`gxs_high_level_translation_of_U4VolumeMaker_Geant4_geometry`

DONE : add u4 gx cx pkgs to the standard build set
---------------------------------------------------

::

     274 om-subs--all(){ cat << EOS
     275 # to update this list : opticks-deps --subdirs
     276 # the names must be the case correct directory names 
     277 okconf
     278 sysrap
     279 boostrap
     280 npy
     281 #yoctoglrap
     282 optickscore
     283 ggeo
     284 #assimprap
     285 #openmeshrap
     286 opticksgeo
     287 cudarap
     288 thrustrap
     289 optixrap
     290 okop
     291 oglrap
     292 opticksgl
     293 ok
     294 extg4
     295 cfg4
     296 okg4
     297 g4ok
     298 integration
     299 ana
     300 analytic
     301 bin
     302 CSG
     303 CSG_GGeo
     304 GeoChain
     305 qudarap
     306 CSGOptiX
     307 u4
     308 g4cx
     309 EOS
     310 }


TODO: switch to OptiX 7 as standard
---------------------------------------------------------------------------------------

Need to change the standard OPTICKS_OPTIX_PREFIX to be the one for 7 so no longer need to b7::

    epsilon:issues blyth$ t opticks-build7
    opticks-build7 () 
    { 
        export OPTICKS_HOME=$(opticks-home);
        opticks-set-optix-prefix 7;     ## sets OPTICKS_OPTIX_PREFIX
        opticks-chkvar OPTICKS_PREFIX OPTICKS_HOME OPTICKS_OPTIX_PREFIX;
        [ $? -ne 0 ] && echo $msg checkvar FAIL && return 1;
        cd_func $(opticks-home)/CSGOptiX;
        local sdir=$(pwd);
        local name=$(basename $sdir);
        local bdir=/tmp/$USER/opticks/${name}.build;
        rm -rf $bdir && mkdir -p $bdir;
        [ ! -d $bdir ] && exit 1;
        cd_func $bdir && pwd;
        cmake $sdir -DCMAKE_BUILD_TYPE=Debug -DOPTICKS_PREFIX=${OPTICKS_PREFIX} -DCMAKE_MODULE_PATH=${OPTICKS_HOME}/cmake/Modules -DCMAKE_INSTALL_PREFIX=${OPTICKS_PREFIX};
        [ $? -ne 0 ] && echo $msg conf FAIL && return 1;
        make;
        [ $? -ne 0 ] && echo $msg make FAIL && return 2;
        make install;
        [ $? -ne 0 ] && echo $msg install FAIL && return 3;
        opticks-set-optix-prefix 6;
        cd_func $sdir && pwd;
        return 0
    }

::

    epsilon:opticks blyth$ t oe-env
    oe-env () 
    { 
        olocal-;
        opticks-;
        source $OPTICKS_PREFIX/bin/opticks-setup.sh 1>&2
    }


The envvars from the build get get enshrined into the $OPTICKS_PREFIX/bin/opticks-setup.sh::

     01 #!/bin/bash
      2 #  
      3 #    D O   N O T   E D I T 
      4 #
      5 # generated by opticks-setup-generate
      6 #
      7 # opticks-setup-hdr- Sun Apr 18 17:32:45 BST 2021
      8 
      9 NAME=$(basename $BASH_SOURCE)
     10 MSG="=== $NAME :"
     11 
     12 if [ "$BASH_SOURCE" == "$0" ]; then
     13    echo $MSG ERROR the $BASH_SOURCE file needs to be sourced not executed
     14    exit 1
     15    # normally would return from sourced script but here have detected are being executed so exit 
     16 fi
     17 
     18 # opticks-setup-prefix- 
     19 
     20 # mandatory envvars from buildenv propagated into userenv via this setup
     21 export OPTICKS_PREFIX=/usr/local/opticks
     22 export OPTICKS_CUDA_PREFIX=/usr/local/cuda
     23 export OPTICKS_OPTIX_PREFIX=/usr/local/optix
     24 
     25 HERE_OPTICKS_PREFIX=$(dirname $(dirname $BASH_SOURCE))


The build envvars on laptop come from ~/.opticks_config::

     56 export OPTICKS_CUDA_PREFIX=/usr/local/cuda
     57 export OPTICKS_OPTIX_PREFIX=/usr/local/optix
     58 export OPTICKS_COMPUTE_CAPABILITY=30
     59 
     60 export OPTICKS_OPTIX5_PREFIX=/usr/local/optix
     61 export OPTICKS_OPTIX7_PREFIX=/Developer/OptiX_700

What about the workstation env, which is mixed up with junoenv ?



