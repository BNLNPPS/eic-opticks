mar2020geom_cxr_scan_shows_global_now_bottleneck
===================================================

GPU workstation::

    cx
    ./cxr_scan.sh 

Laptop::

    cx
    ./grabsnap.sh grab
    ./grabsnap.sh --rst


::

    [2022-03-07 19:45:28,272] p74583 {/Users/blyth/opticks/ana/snap.py:196} INFO - raw_paths 32 : 1st /Users/blyth/.opticks/geocache/DetSim0Svc_pWorld_g4live/g4ok_gltf/41c046fe05b28cb70b1fc65d0e6b7749/1/CSG_GGeo/CSGOptiXRenderTest/cvd1/70000/cxr_overview/cam_0_tmin_0.4/cxr_overview_emm_9,_moi_-1.jpg 


+---+----------+------------------+------------------+------------------------------------------------------------------------------+
|idx|        -e|       time(s)    |      relative    |    enabled geometry description 41c046fe                                     |
+===+==========+==================+==================+==============================================================================+
|  0|        5,|        0.0004    |        0.0533    |    ONLY: 1:sStrutBallhead                                                    |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
|  1|        9,|        0.0004    |        0.0576    |    ONLY: 130:sPanel                                                          |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
|  2|        7,|        0.0005    |        0.0723    |    ONLY: 1:base_steel                                                        |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
|  3|        6,|        0.0007    |        0.0910    |    ONLY: 1:uni1                                                              |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
|  4|        8,|        0.0007    |        0.0919    |    ONLY: 1:uni_acrylic1                                                      |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
|  5|        1,|        0.0010    |        0.1360    |    ONLY: 5:PMT_3inch_pmt_solid                                               |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
|  6|        4,|        0.0019    |        0.2609    |    ONLY: 5:mask_PMT_20inch_vetosMask_virtual                                 |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
|  7|        3,|        0.0045    |        0.6059    |    ONLY: 6:HamamatsuR12860sMask_virtual                                      |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
|  8|        2,|        0.0050    |        0.6788    |    ONLY: 7:NNVTMCPPMTsMask_virtual                                           |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
|  9|       t0,|        0.0073    |        0.9878    |    EXCL: 3089:sWorld                                                         |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
| 10|   1,2,3,4|        0.0074    |        1.0000    |    ONLY PMT                                                                  |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
| 11|      t8,0|        0.0077    |        1.0295    |    EXCL: 1:uni_acrylic1 3089:sWorld                                          |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
| 12|        0,|        0.0107    |        1.4408    |    ONLY: 3089:sWorld                                                         |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
| 13|       t2,|        0.0117    |        1.5768    |    EXCL: 7:NNVTMCPPMTsMask_virtual                                           |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
| 14|       t4,|        0.0119    |        1.5965    |    EXCL: 5:mask_PMT_20inch_vetosMask_virtual                                 |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
| 15|       t3,|        0.0120    |        1.6185    |    EXCL: 6:HamamatsuR12860sMask_virtual                                      |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
| 16|       t7,|        0.0122    |        1.6393    |    EXCL: 1:base_steel                                                        |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
| 17|       t1,|        0.0122    |        1.6409    |    EXCL: 5:PMT_3inch_pmt_solid                                               |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
| 18|       t9,|        0.0122    |        1.6411    |    EXCL: 130:sPanel                                                          |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
| 19|       t5,|        0.0122    |        1.6416    |    EXCL: 1:sStrutBallhead                                                    |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
| 20|       t8,|        0.0122    |        1.6471    |    EXCL: 1:uni_acrylic1                                                      |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
| 21|        t0|        0.0122    |        1.6471    |    ALL                                                                       |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+
| 22|       t6,|        0.0122    |        1.6475    |    EXCL: 1:uni1                                                              |
+---+----------+------------------+------------------+------------------------------------------------------------------------------+



Bottleneck looks to be "3089:sWorld"

Need to find way to vary contexts of that...

* added --cxskiplv to so this

* --cxskiplv 102,103 gives 0.0073



Dumping the prim::

    c
    epsilon:CSG blyth$ ./CSGPrimTest.sh 

     ridx :  0   ridx_prims.shape (3089, 4, 4) 
     u_mx c_mx :  midx prim counts and meshname  : prs.shape 
        0    1 :       sTopRock_domeAir0x578ca70 :  (1, 4, 4) : [-25000. -26760.  -4770.  31250.  26760.  48750.      0.      0.]  
        1    1 :          sTopRock_dome0x578c520 :  (1, 4, 4) : [-28000. -29760.  -7770.  34250.  29760.  51750.      0.      0.]  
        2    1 :           sDomeRockBox0x578c210 :  (1, 4, 4) : [-31125. -27500.  -9500.  31125.  27500.   9500.      0.      0.]  
        3    1 :           PoolCoversub0x578d9b0 :  (1, 4, 4) : [-21800. -21800.  21749.  21800.  21800.  21753.      0.      0.]  
        4    1 :          Upper_LS_tube0x71a38f0 :  (1, 4, 4) : [ -400.  -400. -1750.   400.   400.  1750.     0.     0.]  
        5    1 :       Upper_Steel_tube0x71a39e0 :  (1, 4, 4) : [ -407.  -407. 20000.   407.   407. 23500.     0.     0.]  
        6    1 :       Upper_Tyvek_tube0x71a3af0 :  (1, 4, 4) : [ -402.  -402. 20000.   402.   402. 23500.     0.     0.]  
        7    1 :          Upper_Chimney0x71a3800 :  (1, 4, 4) : [ -412.  -412. -1750.   412.   412.  1750.     0.     0.]  
       12  126 :                 sPlane0x71a8bb0 :(126, 4, 4) : [-3430.6  -3385.15    -6.65  3430.6   3385.15     6.65     0.       0.  ]  
       13   63 :                  sWall0x71a8b30 : (63, 4, 4) : [-3430.6 -3430.6   -13.8  3430.6  3430.6    13.8     0.      0. ]  
       14    1 :                 sAirTT0x71a76a0 :  (1, 4, 4) : [-24000. -24000.  21752.  24000.  24000.  30152.      0.      0.]  
       15    1 :               sExpHall0x578d4f0 :  (1, 4, 4) : [-31250. -24500.  21750.  31250.  24500.  32750.      0.      0.]  
       16    1 :            sExpRockBox0x578ce00 :  (1, 4, 4) : [-31125. -27500.  -5500.  31125.  27500.   5500.      0.      0.]  
       17    1 :               sTopRock0x578c0a0 :  (1, 4, 4) : [-31125. -27500. -15000.  31125.  27500.  15000.      0.      0.]  
       90    2 :       solidSJCLSanchor0x5962500 :  (2, 4, 4) : [   -60.    -12773.921  12245.275     60.    -12683.368  12338.543      0.         0.   ]  
       91   36 :         solidSJFixture0x5966940 : (36, 4, 4) : [-15179.856  -8778.528   2559.474 -15138.459  -8726.628   2610.399      0.         0.   ]  
       92    8 :        solidSJReceiver0x5964f50 :  (8, 4, 4) : [-15358.562   8792.987    -60.    -15289.901   8901.911     60.         0.         0.   ]  
       93    8 : solidSJReceiverFastern0x5969570 :  (8, 4, 4) : [-15352.4     8777.157    -62.    -15265.26    8901.24      62.         0.         0.   ]  
       94    1 :                sTarget0x5829bb0 :  (1, 4, 4) : [-17700. -17700. -17700.  17700.  17700.  17824.      0.      0.]  
       95    1 :               sAcrylic0x5829590 :  (1, 4, 4) : [-17824. -17824. -17824.  17824.  17824.  17824.      0.      0.]  
       96  370 :                 sStrut0x582c680 :(370, 4, 4) : [ -42.5    -42.5   -774.027   42.5     42.5    774.027    0.       0.   ]  
       97  220 :                 sStrut0x5880150 :(220, 4, 4) : [ -30.     -30.    -774.039   30.      30.     774.039    0.       0.   ]  
      102   56 :          solidXJanchor0x5933100 : (56, 4, 4) : [ -141.592 -1800.876 17733.078   -16.254 -1675.153 17764.264     0.        0.   ]  
      103   56 :         solidXJfixture0x595f360 : (56, 4, 4) : [ -144.657 -1801.932    -0.        0.        0.    17790.158     0.        0.   ]  
      123    1 :        sChimneyAcrylic0x71a6010 :  (1, 4, 4) : [ -524.  -524. 17824.   524.   524. 18424.     0.     0.]  
      124    1 :             sChimneyLS0x71a61f0 :  (1, 4, 4) : [ -400.  -400. -1963.   400.   400.  1963.     0.     0.]  
      125    1 :          sChimneySteel0x71a63d0 :  (1, 4, 4) : [ -405.  -405. 18424.   405.   405. 21750.     0.     0.]  
      126    1 :             sWaterTube0x71a5e30 :  (1, 4, 4) : [ -524.  -524. -1963.   524.   524.  1963.     0.     0.]  
      127    1 :            sInnerWater0x5828f70 :  (1, 4, 4) : [-19629. -19629. -19629.  19629.  19629.  21750.      0.      0.]  
      128    1 :         sReflectorInCD0x58289b0 :  (1, 4, 4) : [-19631. -19631. -19631.  19631.  19631.  21750.      0.      0.]  
      135    1 :        sOuterWaterPool0x5792bd0 :  (1, 4, 4) : [-21750. -21750. -21750.  21750.  21750.  21750.      0.      0.]  
      136    1 :            sPoolLining0x57924c0 :  (1, 4, 4) : [-21755. -21755. -21755.  21755.  21755.  21750.      0.      0.]  
      137    1 :            sBottomRock0x578e0e0 :  (1, 4, 4) : [-24750. -24750. -24750.  24750.  24750.  21750.      0.      0.]  
      138    1 :                 sWorld0x577e4d0 :  (1, 4, 4) : [-60000. -60000. -60000.  60000.  60000.  60000.      0.      0.]  
     skip:72  nmame_skip:Flange 


Need to control which midx get included into global so can see which is
causing the bottleneck.  Expecting: solidXJfixture
        
::

     87        bool isCSGSkipLV(unsigned lvIdx) const ;         // --csgskiplv
     88        bool isDeferredCSGSkipLV(unsigned lvIdx) const ; // --deferredcsgskiplv
     89        bool isSkipSolidIdx(unsigned lvIdx) const ;      // --skipsolidname 
     90 


Its easier to do the skipping post geocache. Do it within CSG_GGeo/CSG_GGeo_Convert.cc


resolution scan : JUNO march 2022 trunk
----------------------------------------------------



+-----------------------------------------------------------+
|         ``EMM=t0, ./cxr_overview.sh`` exclude global      |
+--------+-----------+--------------+---------+-------------+
| resol  | size      |  pixels      | launch  |  norm to 1M |
+========+===========+==============+=========+=============+
| 1.5    | 1920,1080 |  2,073,600   | 0.0074  |   0.0036    |
+--------+-----------+--------------+---------+-------------+
|  1     | 1280,720  |   921,600    | 0.0039  |   0.0042    |
+--------+-----------+--------------+---------+-------------+


adding profile tags
---------------------

::

    #include <nvtx3/nvToolsExt.h>

    nvtxRangePushA("DescriptionString");
    nvtxRangePop();






